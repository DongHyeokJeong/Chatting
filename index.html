<!doctype html>
<html>
<head>
  <title>Socket.IO chat</title>
  <style>
    /*초기화*/
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font: 13px Helvetica, Arial; }
    form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
    form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }

    header { background: #fffff0; width: 100%; margin:0 auto; height:15%; position: relative;}

    /*입장, 퇴장 알림창*/
    #nav_EntranceExit { height:7%; padding: 5px; font-size: 40px; }

    /*닉네임 변화*/
    #nav_NicknameChange { padding: 3px; position:absolute; right:10px; top:10px; width:100px; height:50px }
    #btn_NicknameChange { background: #ffffff; width:77px; height:42px }

    /*온라인 접속자 목록*/
    #nar_OnlineUser { height:3%; border:1px solid crimson;}

    #content {position:absolute; height:75%; width:100%; margin:0 auto; overflow:scroll;}

    /*채팅창*/
    #Section_Messages {width: 100%;}
    #messages { list-style-type: none; margin: 0; padding: 0; }
    #messages li { padding: 5px 10px; }
    #messages li:nth-child(odd) { background: #eee; }

    /*메세지 전송창*/
    /*#footer_MessageSubmit {    }*/
    #messagesForm { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }

    /*레이어 팝업*/
    #layer { position:absolute; z-index:9000; background-color:#000; display:none; left:0; top:0; }
    #nicknameEnter { background: #000; padding: 3px; position: fixed; bottom: 50%; width: 100%; }

  </style>
  <script src="/socket.io/socket.io.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script>
      function wrapWindowByMask(){ //레이어 팝업
          //화면의 높이와 너비를 구한다.
          var maskHeight = $(window).height();
          var maskWidth = $(window).width();

          //마스크의 높이와 너비를 화면 것으로 만들어 전체 화면을 채운다.
          $('#layer').css({'width':maskWidth,'height':maskHeight});

          //애니메이션 효과 - 일단 1초동안 까맣게 됐다가 80% 불투명도로 간다.
          $('#layer').fadeIn(1000);
          $('#layer').fadeTo("slow",0.8);
      }

      $(document).ready(function(){
          var nickName;
          wrapWindowByMask();
          var socket = io();
          // 닉네임 입력
          $('#btn_nicknameEnter').click(function(e){
              nickName = $('#input_Nickname').val();
              socket.emit('entrance', {nickName:nickName});
              e.preventDefault();
              $('#layer').hide();
          });
          // 채팅 입력
          $('#messagesForm').submit(function(e){
              var msg = $('#m').val();
              socket.emit('chat message', {nickName:nickName, msg:msg});
              $('#m').val('');
              e.preventDefault();
          });
          //닉네임 바꾸기
          $('#btn_NicknameChange').click(function(){
              $('#input_Nickname').val('');
              wrapWindowByMask();
          });

          socket.on('chat message', function(data){
              if(data) {
                  if(data.alert) {
                      alert(data.alert + data.msg);
                  }
                  else {
                      var tag = '<li><b>' + data.nickName + '</b> : ' + data.msg + '</li>';
                      $('#messages').append(tag);
                      $("#content").scrollTop($("#content")[0].scrollHeight);
                  }
              }
          });
          // 입장 알림
          socket.on('entranceAlarm', function(msg){
              var html = '<li><b>' + msg.nickName + '  in!! </b></li>';
              $('#entrance_Exit')[0].innerHTML = html;
          });
          // 퇴장 알림
          socket.on('exitAlarm', function(msg){
              var html = '<li><b>' + msg.nickName + '  out!! </b></li>';
              $('#entrance_Exit')[0].innerHTML = html;
          });
          // 온라인 유저 표시
          socket.on('onlineUser', function(users){
              if(users) {
                  var html = '<li>Now online member : ';
                  for(var user in users) {
                      html += users[user] + ' ';
                  }
                  html += '</li>';
                  $('#onlineUser')[0].innerHTML = html;
              }
          });
      });
  </script>
</head>
<body>
<!--레이어 팝업-->
<div id="layer">
  <form id="nicknameEnter" action="">
    <p><font color="#f0f8ff">Enter you nickname</font></p>
    <input id="input_Nickname" autocomplete="off" /><button id="btn_nicknameEnter">Select</button>
  </form>
</div>

  <header>
    <nav id="nav_EntranceExit" align="center" > <!--입장 퇴장 안내하는 공간-->
        <ul id="entrance_Exit"></ul>
    </nav>

    <nav id="nav_NicknameChange"> <!--닉네임 변경-->
        <button id='btn_NicknameChange''>Change Nickname</button>
    </nav>

    <nav id="nar_OnlineUser" align="center">  <!--//접속자 표시-->
      <ul id="onlineUser"></ul>
    </nav>
  </header>


  <div id="content">
    <section id="Section_Messages"> <!--메세지 창-->
        <ul id="messages"></ul>
    </section>
  </div>

  <footer id="footer_MessageSubmit"> <!--메세지 보내는 곳-->
    <form id="messagesForm" action="">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>
  </footer>
</body>
</html>